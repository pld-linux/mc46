--- mc-4.6.0/lib/mc.ext.in.orig	Mon Apr 28 02:16:28 2003
+++ mc-4.6.0/lib/mc.ext.in	Sun Apr 27 23:36:33 2003
@@ -108,28 +108,28 @@
 
 # C
 shell/.c
-	Open=%var{EDITOR:vi} %f
+	Open=%var{EDITOR:vi} '%f'
 
 # Fortran
 shell/.f
-	Open=%var{EDITOR:vi} %f
+	Open=%var{EDITOR:vi} '%f'
 	
 # Header
 shell/.h
-	Open=%var{EDITOR:vi} %f
+	Open=%var{EDITOR:vi} '%f'
 
 # Object
 shell/.o
-	#Open=%var{PAGER:more} %f
-	View=%view{ascii} file %f && nm %f
+	#Open=%var{PAGER:more} '%f'
+	View=%view{ascii} file '%f' && nm '%f'
 
 # Asm
 shell/.s
-	Open=%var{EDITOR:vi} %f
+	Open=%var{EDITOR:vi} '%f'
 
 # C++
 regex/\.(C|cc)$
-	Open=%var{EDITOR:vi} %f
+	Open=%var{EDITOR:vi} '%f'
 
 ### Documentation ###
 
@@ -138,19 +138,19 @@
 
 # GNU Info page
 type/^Info\ text
-	Open=info -f %f
+	Open=info -f '%f'
 
 shell/.info
-	Open=info -f %f
+	Open=info -f '%f'
 
 # Manual page
 # Exception - .so libraries are not manual pages
 regex/\.(so|so\.[0-9\.]*)$
-	View=%view{ascii} file %f && nm %f
+	View=%view{ascii} file '%f' && nm '%f'
 
 regex/(([^0-9]|^[^\.]*)\.([1-9][A-Za-z]*|n)|\.man)$
-	Open=nroff @MAN_FLAGS@ @MANDOC@ %f | %var{PAGER:more}
-	View=%view{ascii,nroff} nroff @MAN_FLAGS@ @MANDOC@ %f
+	Open=nroff @MAN_FLAGS@ @MANDOC@ '%f' | %var{PAGER:more}
+	View=%view{ascii,nroff} nroff @MAN_FLAGS@ @MANDOC@ '%f'
 
 # Troff with me macros.
 # Exception - "read.me" is not a nroff file.
@@ -159,26 +159,26 @@
 	View=
 
 shell/.me
-	Open=nroff @MAN_FLAGS@ -me %f | %var{PAGER:more}
-	View=%view{ascii,nroff} nroff @MAN_FLAGS@ -me %f
+	Open=nroff @MAN_FLAGS@ -me '%f' | %var{PAGER:more}
+	View=%view{ascii,nroff} nroff @MAN_FLAGS@ -me '%f'
 
 # Troff with ms macros.
 shell/.ms
-	Open=nroff @MAN_FLAGS@ -ms %f | %var{PAGER:more}
-	View=%view{ascii,nroff} nroff @MAN_FLAGS@ -ms %f
+	Open=nroff @MAN_FLAGS@ -ms '%f' | %var{PAGER:more}
+	View=%view{ascii,nroff} nroff @MAN_FLAGS@ -ms '%f'
 
 # Manual page - compressed
 regex/([^0-9]|^[^\.]*)\.([1-9][a-z]?|n)\.g?[Zz]$
-	Open=gzip -dc %f | nroff @MAN_FLAGS@ @MANDOC@ | %var{PAGER:more}
-	View=%view{ascii,nroff} gzip -dc %f | nroff @MAN_FLAGS@ @MANDOC@
+	Open=gzip -dc '%f' | nroff @MAN_FLAGS@ @MANDOC@ | %var{PAGER:more}
+	View=%view{ascii,nroff} gzip -dc '%f' | nroff @MAN_FLAGS@ @MANDOC@
 
 regex/([^0-9]|^[^\.]*)\.([1-9][a-z]?|n)\.bz$
-	Open=bzip -dc %f | nroff @MAN_FLAGS@ @MANDOC@ | %var{PAGER:more}
-	View=%view{ascii,nroff} bzip -dc %f | nroff @MAN_FLAGS@ @MANDOC@
+	Open=bzip -dc '%f' | nroff @MAN_FLAGS@ @MANDOC@ | %var{PAGER:more}
+	View=%view{ascii,nroff} bzip -dc '%f' | nroff @MAN_FLAGS@ @MANDOC@
 
 regex/([^0-9]|^[^\.]*)\.([1-9][a-z]?|n)\.bz2$
-	Open=bzip2 -dc %f | nroff @MAN_FLAGS@ @MANDOC@ | %var{PAGER:more}
-	View=%view{ascii,nroff} bzip2 -dc %f | nroff @MAN_FLAGS@ @MANDOC@
+	Open=bzip2 -dc '%f' | nroff @MAN_FLAGS@ @MANDOC@ | %var{PAGER:more}
+	View=%view{ascii,nroff} bzip2 -dc '%f' | nroff @MAN_FLAGS@ @MANDOC@
 
 
 ### Images ###
@@ -211,43 +211,43 @@
 	Include=image
 
 shell/.xcf
-	Open=gimp %f
+	Open=gimp '%f'
 
 shell/.xbm
-	Open=bitmap %f
+	Open=bitmap '%f'
 
 shell/.xpm
 	Include=image
-	View=sxpm %f
+	View=sxpm '%f'
 
 include/image
-	Open=if [ "$DISPLAY" = "" ]; then zgv %f; else (ee %f &); fi
-	View=%view{ascii} identify %f
-	#View=%view{ascii} asciiview %f
+	Open=if [ "$DISPLAY" = "" ]; then zgv '%f'; else (ee '%f' &); fi
+	View=%view{ascii} identify '%f'
+	#View=%view{ascii} asciiview '%f'
 
 
 ### Sound files ###
 
 regex/\.(wav|WAV|Wav|snd|SND|Snd|voc|VOC|Voc|au|AU|Au)$
-       Open=play %f
+       Open=play '%f'
 
 regex/\.(mod|MOD|Mod|s3m|S3M|S3m|xm|XM|Xm)$
-       Open=mikmod %f
-       #Open=tracker %f
+       Open=mikmod '%f'
+       #Open=tracker '%f'
 
 regex/\.(wav22|WAV22)$
-       Open=vplay -s 22 %f
+       Open=vplay -s 22 '%f'
 
 regex/\.(mp3|MP3|Mp3)$
-	Open=if [ "$DISPLAY" = "" ]; then mpg123 %f; else (xmms %f &); fi
-	View=%view{ascii} mpg123 -vtn1 %f 2>&1 | sed -n '/^Title/,/^Comment/p;/^MPEG/,/^Audio/p'
+	Open=if [ "$DISPLAY" = "" ]; then mpg123 '%f'; else (xmms '%f' &); fi
+	View=%view{ascii} mpg123 -vtn1 '%f' 2>&1 | sed -n '/^Title/,/^Comment/p;/^MPEG/,/^Audio/p'
 
 regex/\.(ogg|OGG|Ogg)$
-	Open=if [ "$DISPLAY" = "" ]; then ogg123 %f; else (xmms %f &); fi
+	Open=if [ "$DISPLAY" = "" ]; then ogg123 '%f'; else (xmms '%f' &); fi
 	View=%view{ascii} ogginfo %s
 
 regex/\.(midi?|MIDI?|Midi?|rmid?|RMID?|Rmid?)$
-	Open=timidity %f
+	Open=timidity '%f'
 
 
 ### Video ###
@@ -274,90 +274,90 @@
 	Include=video
 
 regex/\.(rm|RM|Rm|ram|RAM|Ram)$
-	Open=(realplay %f >/dev/null 2>&1 &)
+	Open=(realplay '%f' >/dev/null 2>&1 &)
 
 include/video
-	Open=(mplayer %f >/dev/null 2>&1 &)
-	#Open=(gtv %f >/dev/null 2>&1 &)
-	#Open=(xanim %f >/dev/null 2>&1 &)
+	Open=(mplayer '%f' >/dev/null 2>&1 &)
+	#Open=(gtv '%f' >/dev/null 2>&1 &)
+	#Open=(xanim '%f' >/dev/null 2>&1 &)
 
 ### Documents ###
 
 # Postscript
 type/^PostScript
-	Open=(gv %f &)
-	View=%view{ascii} ps2ascii %f
+	Open=(gv '%f' &)
+	View=%view{ascii} ps2ascii '%f'
 
 # PDF
 type/^PDF
-	Open=(xpdf %f &)
-	#Open=(acroread %f &)
-	#Open=(ghostview %f &)
-	View=%view{ascii} pdftotext %f -
+	Open=(xpdf '%f' &)
+	#Open=(acroread '%f' &)
+	#Open=(ghostview '%f' &)
+	View=%view{ascii} pdftotext '%f' -
 
 # The following code very ugly and should not be taken as example.
 # It should be cleaned up when the new format of mc.ext is developed.
 
 # html
 regex/\.([Hh]tml?|HTML?)$
-	Open=if test -n "@X11_WWW@" && test -n "$DISPLAY"; then (@X11_WWW@ file://%d/%p &) >/dev/null 2>&1; else links %f 2>/dev/null || lynx -force_html %f; fi
-	View=%view{ascii} lynx -dump -force_html %f
+	Open=if test -n "gnome-moz-remote" && test -n "$DISPLAY"; then (gnome-moz-remote file://%d/%p &) >/dev/null 2>&1; else links '%f' 2>/dev/null || lynx -force_html '%f'; fi
+	View=%view{ascii} lynx -dump -force_html '%f'
 
 # StarOffice 5.2
 shell/.sdw
-	Open=(ooffice %f &)
+	Open=(ooffice '%f' &)
 
 # StarOffice 6 and OpenOffice.org formats
 regex/\.(sxw|stw|sxc|stc|sxi|sti|sxd|std|sxm|sxg)$
-	Open=(ooffice %f &)
+	Open=(ooffice '%f' &)
 
 # AbiWord
 shell/.abw
-	Open=(abiword %f &)
+	Open=(abiword '%f' &)
 
 # Microsoft Word Document
 regex/\.([Dd]o[ct]|DO[CT]|[Ww]ri|WRI)$
-	Open=(abiword %f >/dev/null 2>&1 &)
-	View=%view{ascii} catdoc -w %f || word2x -f text %f - || strings %f
+	Open=(abiword '%f' >/dev/null 2>&1 &)
+	View=%view{ascii} catdoc -w '%f' || word2x -f text '%f' - || strings '%f'
 type/^Microsoft\ Word
-	Open=(abiword %f >/dev/null 2>&1 &)
-	View=%view{ascii} catdoc -w %f || word2x -f text %f - || strings %f
+	Open=(abiword '%f' >/dev/null 2>&1 &)
+	View=%view{ascii} catdoc -w '%f' || word2x -f text '%f' - || strings '%f'
 
 # RTF document
 regex/\.(rtf|RTF|Rtf)$
-	Open=(abiword %f >/dev/null 2>&1 &)
+	Open=(abiword '%f' >/dev/null 2>&1 &)
 
 # Microsoft Excel Worksheet
 regex/\.([Xx]l[sw]|XL[SW])$
-	Open=(gnumeric %f >/dev/null 2>&1 &)
-	View=%view{ascii} xls2csv %f || strings %f
+	Open=(gnumeric '%f' >/dev/null 2>&1 &)
+	View=%view{ascii} xls2csv '%f' || strings '%f'
 type/^Microsoft\ Excel
-	Open=(gnumeric %f >/dev/null 2>&1 &)
-	View=%view{ascii} xls2csv %f || strings %f
+	Open=(gnumeric '%f' >/dev/null 2>&1 &)
+	View=%view{ascii} xls2csv '%f' || strings '%f'
 
 # Use OpenOffice.org to open any MS Office documents
 type/^Microsoft\ Office\ Document
-	Open=(ooffice %f &)
+	Open=(ooffice '%f' &)
 
 # Framemaker
 type/^FrameMaker
-	Open=fmclient -f %f
+	Open=fmclient -f '%f'
 
 # DVI
 regex/\.([Dd]vi|DVI)$
-	Open=if [ x$DISPLAY = x ]; then dvisvga %f; else (xdvi %f &); fi
-	View=%view{ascii} dvi2tty %f
+	Open=if [ x$DISPLAY = x ]; then dvisvga '%f'; else (xdvi '%f' &); fi
+	View=%view{ascii} dvi2tty '%f'
 
 # TeX
 regex/\.([Tt]ex|TEX|TeX)$
-	Open=%var{EDITOR:vi} %f
+	Open=%var{EDITOR:vi} '%f'
 
 
 ### Miscellaneous ###
 
 # Makefile
 regex/[Mm]akefile$
-	Open=make -f %f %{Enter parameters}
+	Open=make -f '%f' %{Enter parameters}
 
 # Imakefile
 shell/Imakefile
@@ -365,16 +365,16 @@
 
 # Makefile.PL (MakeMaker)
 regex/^Makefile.(PL|pl)$
-	Open=%var{PERL:perl} %f
+	Open=%var{PERL:perl} '%f'
 
 # dbf
 regex/\.(dbf|DBF)$
-       Open=%view{ascii} dbview %f
-       View=%view{ascii} dbview -b %f
+       Open=%view{ascii} dbview '%f'
+       View=%view{ascii} dbview -b '%f'
 
 # REXX script
 regex/\.(rexx|rex|cmd)$
-       Open=rexx %f %{Enter parameters};echo "Press ENTER";read y
+       Open=rexx '%f' %{Enter parameters};echo "Press ENTER";read y
 
 
 ### Archives ###
@@ -382,62 +382,61 @@
 # .tgz, .tpz, .tar.gz, .tar.z, .tar.Z
 regex/\.t([gp]?z|ar\.g?[zZ])$
 	Open=%cd %p#utar
-	View=%view{ascii} gzip -dc %f 2>/dev/null | tar tvvf -
+	View=%view{ascii} gzip -dc '%f' 2>/dev/null | tar tvvf -
 
 regex/\.tar\.bz$
 	# Open=%cd %p#utar
-	View=%view{ascii} bzip -dc %f 2>/dev/null | tar tvvf -
+	View=%view{ascii} bzip -dc '%f' 2>/dev/null | tar tvvf -
 
 regex/\.tar\.bz2$
 	Open=%cd %p#utar
-	View=%view{ascii} bzip2 -dc %f 2>/dev/null | tar tvvf -
+	View=%view{ascii} bzip2 -dc '%f' 2>/dev/null | tar tvvf -
 
 # .tar.F - used in QNX
 regex/\.tar\.F$
 	# Open=%cd %p#utar
-	View=%view{ascii} freeze -dc %f 2>/dev/null | tar tvvf -
+	View=%view{ascii} freeze -dc '%f' 2>/dev/null | tar tvvf -
 
 # tar
 regex/\.(tar|TAR)$
 	Open=%cd %p#utar
-	View=%view{ascii} tar tvvf %f
+	View=%view{ascii} tar tvvf '%f'
 
 # zip
 type/^Zip\ archive
 	Open=%cd %p#uzip
-	View=%view{ascii} unzip -v %f
+	View=%view{ascii} unzip -v '%f'
 
 # zoo
 regex/\.(zoo|ZOO)$
 	Open=%cd %p#uzoo
-	View=%view{ascii} zoo l %f
+	View=%view{ascii} zoo l '%f'
 	
 # lha
 type/^LHa\ .*archive
 	Open=%cd %p#ulha
-	View=%view{ascii} lha l %f
+	View=%view{ascii} lha l '%f'
 
 # arj
 regex/\.a(rj|[0-9][0-9])$
 	Open=%cd %p#uarj
-	View=%view{ascii} unarj l %f
+	View=%view{ascii} unarj l '%f'
 
 # esp
 regex/\.e(sp|[0-9][0-9])$
 	Open=%cd %p#uesp
-	View=%view{ascii} unesp v %f
-	Extract=unesp x %f
-	Icon=compressed.xpm
+	View=%view{ascii} unesp v '%f'
+	Extract=unesp x '%f'
 
 # ha
 regex/\.(ha|HA|Ha)$
 	Open=%cd %p#uha
-	View=%view{ascii} ha lf %f
+	View=%view{ascii} ha lf '%f'
 
 # rar
 regex/\.[rR]([aA][rR]|[0-9][0-9])$
 	Open=%cd %p#urar
-	View=%view{ascii} rar v -c- %f
+	View=%view{ascii} rar v -c- '%f'
 
 # cpio
 shell/.cpio.Z
@@ -453,38 +452,53 @@
 	View=%view{ascii} cpio -itv <'%f' 2>/dev/null
 
 # ls-lR
-regex/(^|\.)ls-?lR(\.g?z|Z|bz2)?$
+regex/(^|\.)ls-?lR(\.gz|Z|bz2)$
 	Open=%cd %p#lslR
 
 # patch
-regex/\.(diff|patch)(\.(bz2|gz|Z))?$
+regex/\.(diff|patch)(\.bz2)$
+	Open=%cd %p#patchfs
+	View=%view{ascii} bzip2 -dc '%f' 2>/dev/null
+
+regex/\.(diff|patch)(\.(gz|Z))$
+	Open=%cd %p#patchfs
+	View=%view{ascii} gzip -dc '%f' 2>/dev/null
+
+regex/\.(diff|patch)$
         Open=%cd %p#patchfs
+	View=%view{ascii} /bin/cat '%f' 2>/dev/null
 
 # gzip
 type/^gzip
-	Open=gzip -dc %f | %var{PAGER:more}
-	View=%view{ascii} gzip -dc %f 2>/dev/null
+	Open=gzip -dc '%f' | %var{PAGER:more}
+	View=%view{ascii} gzip -dc '%f' 2>/dev/null
+
+regex/\.(gz|Z)?$
+	View=%view{ascii} gzip -dc '%f' 2>/dev/null
 
 # bzip2
 type/^bzip2
-	Open=bzip2 -dc %f | %var{PAGER:more}
-	View=%view{ascii} bzip2 -dc %f 2>/dev/null
+	Open=bzip2 -dc '%f' | %var{PAGER:more}
+	View=%view{ascii} bzip2 -dc '%f' 2>/dev/null
+
+regex/\.bz2?$
+	View=%view{ascii} bzip2 -dc '%f' 2>/dev/null
 
 # bzip
 type/^bzip
-	Open=bzip -dc %f | %var{PAGER:more}
-	View=%view{ascii} bzip -dc %f 2>/dev/null
+	Open=bzip -dc '%f' | %var{PAGER:more}
+	View=%view{ascii} bzip -dc '%f' 2>/dev/null
 
 # compress
 type/^compress
-	Open=gzip -dc %f | %var{PAGER:more}
-	View=%view{ascii} gzip -dc %f 2>/dev/null
+	Open=gzip -dc '%f' | %var{PAGER:more}
+	View=%view{ascii} gzip -dc '%f' 2>/dev/null
 
 # ar library
 regex/\.s?a$
 	Open=%cd %p#uar
-	#Open=%view{ascii} ar tv %f
-	View=%view{ascii} file %f && nm %f
+	#Open=%view{ascii} ar tv '%f'
+	View=%view{ascii} file '%f' && nm '%f'
 
 # trpm
 regex/\.trpm$
@@ -494,19 +508,19 @@
 # RPM packages (SuSE uses *.spm for source packages)
 regex/\.(src\.rpm|spm)$
 	Open=%cd %p#srpm
-	View=%view{ascii} if rpm --nosignature --version >/dev/null 2>&1; then RPM="rpm --nosignature" ; else RPM="rpm" ; fi ; $RPM -qivlp --scripts %f
+	View=%view{ascii} if rpm --nosignature --version >/dev/null 2>&1; then RPM="rpm --nosignature" ; else RPM="rpm" ; fi ; $RPM -qivlp --scripts '%f'
 
 regex/\.rpm$
 	Open=%cd %p#rpm
-	View=%view{ascii} if rpm --nosignature --version >/dev/null 2>&1; then RPM="rpm --nosignature" ; else RPM="rpm" ; fi ; $RPM -qivlp --scripts %f
+	View=%view{ascii} if rpm --nosignature --version >/dev/null 2>&1; then RPM="rpm --nosignature" ; else RPM="rpm" ; fi ; $RPM -qivlp --scripts '%f'
 
 # deb
 regex/\.deb$
 	Open=%cd %p#deb
-	View=%view{ascii} dpkg-deb -c %f
+	View=%view{ascii} dpkg-deb -c '%f'
 # for dpkg-less systems:
 #	Open=%cd %p#uar
-#	View=%view{ascii} ar p %f control.tar.gz | tar xzO control ./control 2>/dev/null ; echo "" ; echo "Filelist:" ; ar p %f data.tar.gz | tar tzv
+#	View=%view{ascii} ar p '%f' control.tar.gz | tar xzO control ./control 2>/dev/null ; echo "" ; echo "Filelist:" ; ar p '%f' data.tar.gz | tar tzv
 
 
 ### Default ###
