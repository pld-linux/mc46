diff -Nur mc-4.5.55.orig/vfs/extfs/rpm mc-4.5.55/vfs/extfs/rpm
--- mc-4.5.55.orig/vfs/extfs/rpm	Thu Apr 19 22:51:41 2001
+++ mc-4.5.55/vfs/extfs/rpm	Thu Sep 27 18:57:20 2001
@@ -42,7 +42,11 @@
     echo "-r-xr-xr-x   1 root     root    39 $DATE INSTALL"
     echo "-r-xr-xr-x   1 root     root    39 $DATE UPGRADE"
     echo "dr-xr-xr-x   3 root     root	   0 $DATE INFO"
-    echo "$FILEPREF 0 $DATE INFO/NAME-VERSION-RELEASE"
+    if [ "`$RPM -qp --qf \"%{SERIAL}\" \"$1\"`" = "(none)" ]; then
+	echo "$FILEPREF 0 $DATE INFO/NAME-VERSION-RELEASE"
+    else
+	echo "$FILEPREF 0 $DATE INFO/NAME-SERIAL:VERSION-RELEASE"
+    fi
     echo "$FILEPREF 0 $DATE INFO/GROUP"
     echo "$FILEPREF 0 $DATE INFO/BUILDHOST"
     echo "$FILEPREF 0 $DATE INFO/SOURCERPM"
@@ -109,18 +113,21 @@
 	echo "$FILEPREF 0 $DATE INFO/REQUIRENAME"
     $RPM -qp --qf "[%{OBSOLETES}\n]" "$1" | grep "(none)" > /dev/null ||
 	echo "$FILEPREF 0 $DATE INFO/OBSOLETES"
+    $RPM -qp --qf "[%{CONFLICTS}\n]" "$1" | grep "(none)" > /dev/null ||
+	echo "$FILEPREF 0 $DATE INFO/CONFLICTS"
     $RPM -qp --qf "[%{PROVIDES}\n]" "$1" | grep "(none)" > /dev/null ||
 	echo "$FILEPREF 0 $DATE INFO/PROVIDES"
     test "`$RPM -qp --qf \"%{CHANGELOGTEXT}\" \"$1\"`" = "(none)" ||
        echo "$FILEPREF 0 $DATE INFO/CHANGELOG"
     else 
+	echo "$FILEPREF 0 $DATE INFO/CONFLICTS"    
 	echo "$FILEPREF 0 $DATE INFO/REQUIRENAME"
 	echo "$FILEPREF 0 $DATE INFO/OBSOLETES"
 	echo "$FILEPREF 0 $DATE INFO/PROVIDES"
         echo "$FILEPREF 0 $DATE INFO/CHANGELOG"
     fi
 
-    $RPM2CPIO "$1" | cpio -tv --quiet
+    $RPM -qlvp "$1" | sed -e 's/^\(..........\)[-t]* /\1 /'    
     echo "$FILEPREF 0 $DATE CONTENTS.cpio"
 }
 
@@ -132,6 +139,7 @@
 	UPGRADE) echo "# Run this to upgrade this RPM package" > "$3"; exit 0;;
 	ERROR) $RPM -qip "$1" > /dev/null 2> "$3"; exit 0;;
 	INFO/NAME-VERSION-RELEASE)	$RPM -qp --qf "%{NAME}-%{VERSION}-%{RELEASE}\n" "$1" > "$3"; exit 0;;
+	INFO/NAME-SERIAL:VERSION-RELEASE) $RPM -qp --qf "%{NAME}-%{SERIAL}:%{VERSION}-%{RELEASE}\n" "$1" > "$3"; exit 0;;
 	INFO/RELEASE)		$RPM -qp --qf "%{RELEASE}\n" "$1" > "$3"; exit 0;;
 	INFO/GROUP)		$RPM -qp --qf "%{GROUP}\n" "$1" > "$3"; exit 0;;
 	INFO/DISTRIBUTION) 	$RPM -qp --qf "%{DISTRIBUTION}\n" "$1" > "$3"; exit 0;;
@@ -146,12 +154,15 @@
 	INFO/COPYRIGHT)		$RPM -qp --qf "%{COPYRIGHT}\n" "$1" >"$3"; exit 0;;
 	INFO/RPMVERSION)	$RPM -qp --qf "%{RPMVERSION}\n" "$1" >"$3"; exit 0;;
 	INFO/REQUIRENAME)	$RPM -qp --qf "[%{REQUIRENAME} %{REQUIREFLAGS:depflags} %{REQUIREVERSION}\n]" "$1" >"$3"; exit 0;;
+	INFO/OBSOLETES)		$RPM -qp --qf "[%{OBSOLETES}\n]" "$1" >"$3"; exit 0;;
+	INFO/CONFLICTS)		$RPM -qp --qf "[%{CONFLICTS}\n]" "$1" >"$3"; exit 0;;	
 	INFO/PROVIDES)		$RPM -qp --qf "[%{PROVIDES}\n]" "$1" >"$3"; exit 0;;
 	INFO/SCRIPTS/PREIN)	$RPM -qp --qf "%{RPMTAG_PREIN}\n" "$1" >"$3"; exit 0;;
 	INFO/SCRIPTS/POSTIN)	$RPM -qp --qf "%{RPMTAG_POSTIN}\n" "$1" >"$3"; exit 0;;
 	INFO/SCRIPTS/PREUN)	$RPM -qp --qf "%{RPMTAG_PREUN}\n" "$1" >"$3"; exit 0;;
 	INFO/SCRIPTS/POSTUN)	$RPM -qp --qf "%{RPMTAG_POSTUN}\n" "$1" >"$3"; exit 0;;
 	INFO/SCRIPTS/VERIFYSCRIPT)	$RPM -qp --qf "%{VERIFYSCRIPT}\n" "$1" >"$3"; exit 0;;
+	INFO/SCRIPTS/TRIGGERSCRIPTS)	$RPM -qp --triggers "$1" > "$3"; exit 0;;
 	INFO/SCRIPTS/ALL)		$RPM -qp --scripts "$1" > "$3"; exit 0;;
 	INFO/SUMMARY)		$RPM -qp --qf "%{SUMMARY}\n" "$1" > "$3"; exit 0;;
 	INFO/OS)		$RPM -qp --qf "%{OS}\n" "$1" > "$3"; exit 0;;
@@ -159,12 +170,12 @@
 	INFO/SIZE)		$RPM -qp --qf "%{SIZE} bytes\n" "$1" > "$3"; exit 0;;
 	CONTENTS.cpio)		$RPM2CPIO "$1" > "$3"; exit 0;;
 	*)
-	    TMPDIR=/tmp/mctmpdir.$$
+	    TMPDIR=${TMPDIR:-/tmp}/mctmpdir.$$
 	    mkdir $TMPDIR || exit 1
 	    cd $TMPDIR
 	    # Files in RPM version 4 and above start with "./" - try both
 	    $RPM2CPIO "$1" | cpio -iumd --quiet "$2" "./$2" >/dev/null
-	    mv "$2" "$3" 2>/dev/null
+	    mv -f "$2" "$3"
 	    cd /
 	    rm -rf $TMPDIR;;
     esac
